package myMarvelcardgamepack;


/**
 * Designer: Timothy Landers
 * Date: 28/10/22
 * Filename: ExtendRandom
 * Purpose: To allow a hero to Extend random effects on an enemy.
 */
import java.util.ArrayList; 
class ExtendRandom extends AfterAbility
{
    String[] effname; 
    String[] efftype;
    int chance; int duration;
    int max; int available=0; //how many effects the ability can extend, before and after checking the chance, respectively
    boolean together; //true for together and false for separate
    public ExtendRandom (int echance, int num, String[] ename, String[] etype, int dur, boolean tog)
    {
        chance=echance; effname=ename; efftype=etype; together=tog; max=num; duration=dur;
    }
    @Override
    public void Use (Character user, Character target, int ignoreme)
    {
        boolean succeed=false; int cando;
        ArrayList<StatEff> removal= new ArrayList<StatEff>();
        for (int i=0; i<effname.length; i++)
        {
            int canadd=target.GetStatCount (target, effname[i], efftype[i]);
            cando+=canadd;
        }
        if (!(target.immunities.contains("Extend"))&&!(target.immunities.contains("Other"))&&cando>0) 
        {
            if (together==true) //the application chance is rolled once for all the effects
            {
                succeed=Card_CoinFlip.Flip(chance+user.Cchance);
                if (succeed==false)
                {
                    System.out.println (user.Cname+"'s Extend failed to apply due to chance."); //(Test) The application chance was "+chance);
                }
                else
                {
                    available=max;
                }
            }
            else if (together==false) //chance calculated separately
            {
                for (int i=0; i<max; i++)
                {
                  succeed=Card_CoinFlip.Flip(chance+user.Cchance);
                  if (succeed==true)
                  {
                      ++available;
                  }
                }
                if (available<=0)
                {
                    System.out.println (user.Cname+"'s Extend failed to apply due to chance."); //(Test) The application chance was "+chance);
                }
            }   
            if (available>0)
            {
                for (int i=0; i<cando; i++)
                {
                    StatEff toext=target.GetRandomStatEff(target, effname[i], efftype[i]);
                    toext.Extended(duration);
                    --available;
                    if (available<=0)
                    {
                        i+=cando;
                    }
                }
            }
        }  
}             
