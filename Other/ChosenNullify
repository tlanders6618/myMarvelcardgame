package myMarvelcardgamepack;


/**
 * Designer: Timothy Landers
 * Date: 20/10/22
 * Filename: NullifyChosen
 * Purpose: To allow a hero to Nullify chosen buffs from an enemy.
 */
import java.util.ArrayList; 
class NullifyChosen extends AfterAbility
{
    String[] buffname; 
    int chance; 
    int available;
    boolean together; //true for together and false for separate
    public BeforeNullifyChosen (int nullifychance, int num, String[] mnameofbufftonullify, boolean tog)
    {
        chance=nullifychance; buffname=mnameofbufftonullify; together=tog; available=num;
    }
    @Override
    public void Use (Character user, Character target, int ignoreme)
    {
        boolean succeed=false;  
        ArrayList<StatEff> removal= new ArrayList<StatEff>();
        if (!(target.immunities.contains("Nullify"))&&!(target.immunities.contains("Other"))&&target.effects.size()>0) 
        {
            if (together==true) //the application chance is rolled once for all the effects
            {
                succeed=Card_CoinFlip.Flip(chance+user.Cchance);
                if (succeed==false)
                {
                    System.out.println (user.Cname+"'s Nullify failed to apply due to chance."); //(Test) The application chance was "+chance);
                }
            }
            else if (target.effects.size()>0) //chance calculated separately
            {
                for (int i=0; i<buffname.length; i++)
                {
                  if (!(buffname[i].equalsIgnoreCase("all"))) //nullify specific buffs on the target, e.g. Counter
                  {
                     for (StatEff eff: target.effects)
                     {
                        if (eff.getefftype().equalsIgnoreCase("Buffs")&&eff.geteffname().equalsIgnoreCase(buffname[i]))
                        {
                            succeed=Card_CoinFlip.Flip(chance+user.Cchance);
                            if (succeed==true)
                            {
                                removal.add(eff); //stores which effects will be removed
                            }
                        }
                     }   
                   }
                  else //nullify any buff
                  {
                     for (StatEff eff: target.effects)
                     {
                        if (eff.getefftype().equalsIgnoreCase("Buffs"))
                        {
                            succeed=Card_CoinFlip.Flip(chance+user.Cchance);
                            if (succeed==true)
                            {
                                removal.add(eff); //stores which effects will be removed
                            }
                        }
                     }   
                   }
                }                    
            }
        }
        if (removal.size()>0) //then choose which to remove
        {
            System.out.println (user.Cname+", choose a buff to Nullify from "+target.Cname+".");
            System.out.println ("Enter the number next to it, not its name."); 
            boolean falg=false; int counter=0; int removeme=616;
            for (StatEff eff: removal)
            {
               int o=counter+1;  
               System.out.println(o+": "+eff.geteffname());
               ++counter;
            }            
            for (int i=0; i<available; i++)
            {
                do
                {
                    removeme=Damage_Stuff.GetInput();
                    --removeme;
                    if (removeme>=0&&removeme<removal.size())
                    {
                        falg=true;
                    }
                }
                while (falg==false);
                StatEff gone= removal.get(removeme);
                System.out.println(target.Cname+"'s "+gone.geteffname()+" was Nullified!");
                target.remove(target, gone.getcode());                        
            }
            --available;
        }
        return 0;
    }
}
